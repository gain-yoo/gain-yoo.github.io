---
published: true
layout: single
title: "[DevOps/Terraform/T1013] 6ì£¼ì°¨ ê³¼ì œ - GitHub Actionsë¡œ Terraform ìë™í™”"
excerpt: "GitHub Actionsë¡œ Terraform ìë™í™”"
categories: DevOps
tag: [Terraform, í˜‘ì—…, State, ì›Œí¬í”Œë¡œ, Git, ìë™í™”, ë¸Œëœì¹˜, GitHub Actions]
toc: true
author_profile: false
sidebar:
    nav: "docs"
---

âœ… ì´ ë¸”ë¡œê¹…ì€ [í…Œë¼í¼ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” IaC](https://www.yes24.com/Product/Goods/119179333) ì±…ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•œë‹¤.  

---

í…Œë¼í¼ ìŠ¤í„°ë””ì˜ ë§ˆì§€ë§‰ ê³¼ì œë¡œ Gihub Actionsë¥¼ ì´ìš©í•œ Terraform ìë™í™”ë¥¼ í•  ê²ƒì´ë‹¤!

ì•„ë˜ í•˜ì‹œì½”í”„ docsë¥¼ ì°¸ê³ í•˜ì—¬ ì§„í–‰í•˜ê² ë‹¤

[ì°¸ì¡° ) Automate Terraform with GitHub Actions | Terraform | HashiCorp Developer](https://developer.hashicorp.com/terraform/tutorials/automation/github-actions)

![Untitled](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/62982f18-11ca-4786-b689-5a12d802cd70)


í…Œë¼í¼ ì½”ë“œëŠ” Githubìœ¼ë¡œ ê´€ë¦¬í•˜ê³  í…Œë¼í¼ State ê´€ë¦¬ëŠ” Terraform Cloudì—ì„œ í•  ê²ƒì´ë‹¤.

í•´ë‹¹ ê·¸ë¦¼ì€ Pull Requestë¥¼ ìš”ì²­í•˜ë©´ Main ë¸Œëœì¹˜ì—ì„œ ìŠ¹ì¸í•˜ì—¬ Terraform Cloudì— ë°˜ì˜ë˜ëŠ” Github Actions ìë™í™” ì›Œí¬í”Œë¡œìš°ì´ë‹¤.

## Terraform Cloud ì„¤ì •

ë¨¼ì € AWS CredentialsëŠ” ìƒì„±í–ˆë‹¤ê³  ê°€ì •í•˜ê³  ì§„í–‰í•˜ê² ë‹¤.

Terraform Cloudì— AWS ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ AWS Credentialsë¥¼ ì¶”ê°€í•˜ê³  Github Actionsì—ì„œ Terraform Cloudì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ API Tokenì„ ìƒì„±í•´ì¤˜ì•¼ í•œë‹¤.

1. Terraform Cloud â†’ AWS
2. Github Actions â†’ Terraform Cloud

ì¼ë‹¨ Workspaceë¥¼ ìƒì„±í•œë‹¤. 

- Type : `API-driven workflow`
- Workspace Name : `learn-terraform-github-actions`

ê·¸ ë‹¤ìŒì€ AWS Credentialsë¥¼ Terraform Cloudì˜ Environment Variablesë¡œ ì¶”ê°€í•´ ì¤„ ê²ƒì´ë‹¤.

![Untitled 1](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/7e46008c-be7d-49cd-9ad9-3582f3eac3a2)


Environment Variablesê°€ ì–´ë”¨ëŠ”ì§€ í•œì°¸ ì°¾ì•˜ëŠ”ë° Workspace > Variables íƒ­ì— ìˆë”ë¼!

Key/Valueì— `AWS_ACCESS_KEY_ID`ì™€ `AWS_SECRET_ACCESS_KEY`ë¥¼ ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•œë‹¤

ì´ ë•Œ, Terraform Cloudì—ì„œëŠ” Environment Variablesë¥¼ `Sensitive` ì˜µì…˜ì„ í†µí•´ ê°€ë¦´ ìˆ˜ë„ ê·¸ëŒ€ë¡œ ë…¸ì¶œí•  ìˆ˜ë„ ìˆë‹¤

![Untitled 2](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/8ce10998-fb4d-4cd1-b1c2-1348edec792f)


ì•„ë˜ ì‚¬ì§„ì€ Sensitive ì˜µì…˜ì„ ì‚¬ìš©í•œ Variablesì™€ ì•ˆí•œ Variablesì˜ ì°¨ì´ì´ë‹¤.

![Untitled 3](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/5cffccc4-39ed-4056-aaab-8b987394694e)


ë‹¤ìŒì€ User Settings > Tokens > Create an API token ìœ¼ë¡œ Github Actionsì—ì„œ ì‚¬ìš©í•  API tokenì„ ìƒì„±í•˜ì

![Untitled 4](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/34286870-042e-42a9-8ee3-ff213b6ad011)


## GitHub Repository ì„¤ì •

í…Œë¼í¼ ì½”ë“œëŠ” ì•„ë˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©!

[ì°¸ì¡° ) https://github.com/hashicorp-education/learn-terraform-github-actions](https://github.com/hashicorp-education/learn-terraform-github-actions)

Use this template > Create a new repositoryë¥¼ í†µí•´ ë‚´ ê°œì¸ ë ˆí¬ì— ì´ ì €ì¥ì†Œì— ìˆëŠ” í…œí”Œë¦¿ì„ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤.

![Untitled 5](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/094e4311-2fae-4d5d-a02b-676fa7171d3b)


ì´ì œ ì´ ë ˆí¬ì˜ Settings > Security > Secrets and variables > Actionsì— ë“¤ì–´ê°€ì„œ Terraform Cloudì˜ API tokenì„ ë“±ë¡í•´ ì¤„ ê²ƒì´ë‹¤

![Untitled 6](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/ba870ba7-88ec-4b7e-9817-3cb74b9d17d4)


## Github Actions Workflow ê²€í† 

- [`main.tf`](https://github.com/hashicorp-education/learn-terraform-github-actions/blob/main/main.tf) : ê°„ë‹¨í•˜ê²Œ ap-northeast-2 ë¦¬ì „ì— apache ì„œë²„ë¥¼ 8080 í¬íŠ¸ë¡œ ë…¸ì¶œì‹œì¼œ ë°°í¬í•˜ëŠ” ì½”ë“œì´ë‹¤.
- [`.github/workflows/terraform-plan.yml`](https://github.com/hashicorp-education/learn-terraform-github-actions/blob/main/.github/workflows/terraform-plan.yml)
    - envì—ì„œ Terrform Cloudì˜ Organization ëª…ì„ ë³€ê²½í•´ ì¤€ë‹¤
        
        ![Untitled 7](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/477cd7e4-c111-4edc-88fa-a60adafe8079)

        
    - repositoryì—ì„œ `contents`ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” `read` ê¶Œí•œê³¼ `pull-requests`ì— ì“¸ ìˆ˜ ìˆëŠ” `write` ê¶Œí•œë„ ìˆì–´ì•¼ í•œë‹¤.
        
        ![Untitled 8](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/327ceff6-20de-4dc6-aa75-f52f24255fc7)

        
    - **Checkout â†’ Upload Configuration â†’ Create Plan Run â†’ Get Plan Output â†’ Update PR** ë‹¨ê³„ë¥¼ ê±°ì¹˜ê²Œ ëœë‹¤. í•´ë‹¹ Git Repoë¥¼ Checkoutí•˜ê³  Terraform Cloudì— ë³€ê²½ì‚¬í•­ì„ ì—…ë¡œë“œí•˜ë©´ì„œ Planì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ì¶œë ¥í•´ ì¤€ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ PRì— ì„¤ëª…ì„ ì¶”ê°€í•œë‹¤.
- [`.github/workflows/terraform-apply.yml`](https://github.com/hashicorp-education/learn-terraform-github-actions/blob/main/.github/workflows/terraform-apply.yml)
    - terraform-plan.yamlê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Organization ëª…ì„ ë³€ê²½í•´ ì¤€ë‹¤.
    - planê³¼ëŠ” ë‹¤ë¥´ê²Œ `contents`ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” `read` ê¶Œí•œë§Œ ì¶”ê°€í•´ ì£¼ì—ˆë‹¤.
        
        ![Untitled 9](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/5c4001f6-ecd9-478e-9e06-f7fbb69fab1d)

        
    - **Checkout â†’ Upload Configuration â†’ Create Apply Run â†’ Apply** ë‹¨ê³„ë¥¼ ê±°ì¹˜ë©° ì´ëŠ” ì‹¤ì œ Applyë¥¼ í•˜ëŠ” ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤.

## í’€ ìš”ì²­ ìƒì„±

1. update-tfc-org ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  checkout í•œë‹¤
    
    ```bash
    $ git checkout -b 'update-tfc-org'
    	Switched to a new branch 'update-tfc-org'
    ```
    
2. ë³€ê²½ì‚¬í•­ì„ addí•˜ê³  commit í•œë‹¤.
    
    ```bash
    $ git add .github/workflows
    $ git commit -m 'Use our Terraform Cloud organization'
    	[update-tfc-org be46701] Use our Terraform Cloud organization
    	 2 files changed, 3 insertions(+), 3 deletions(-)
    ```
    
3. git pushë¡œ ì›ê²© ë ˆí¬ì— ë°˜ì˜í•œë‹¤
    
    ```bash
    $ git push origin update-tfc-org
    	Enumerating objects: 11, done.
    	Counting objects: 100% (11/11), done.
    	Delta compression using up to 8 threads
    	Compressing objects: 100% (6/6), done.
    	Writing objects: 100% (6/6), 601 bytes | 150.00 KiB/s, done.
    	Total 6 (delta 3), reused 0 (delta 0)
    	remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
    	remote: 
    	remote: Create a pull request for 'update-tfc-org' on GitHub by visiting:
    	remote:      https://github.com/gain-yoo/learn-terraform-github-actions/pull/new/update-tfc-org
    	remote: 
    	To https://github.com/gain-yoo/learn-terraform-github-actions.git
    	 * [new branch]      update-tfc-org -> update-tfc-org
    ```
    

## í’€ ìš”ì²­ ê²€í†  ë° ë³‘í•©

pushí•˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì´ PRì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤

![Untitled 10](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/8d5e66a5-9c6b-4294-9d54-e0975b34469b)


ì ê·¸ëŸ¼ LGTM ë©”ì„¸ì§€ì™€ í•¨ê»˜ PRì„ ìƒì„±í•˜ê² ë‹¤!

![Untitled 11](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/59bcc122-89fa-4d4e-8f0c-cde78c3c3f88)


ì´ ë•Œ, `base`ì™€ `compare`ì˜ ë¸Œëœì¹˜ë¥¼ ì˜ í™•ì¸í•˜ì—¬ ì§„í–‰í•  ê²ƒ!

ì˜¤ Planì´ ì‹¤í–‰ëœë‹¤!!

- Github Actions ì‹¤í–‰
    
    ![Untitled 12](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/380e5a62-238f-471f-8d7b-a3735248a91c)

    
    ![Untitled 13](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/1b141e5d-3535-4e65-8cd6-15d9404c17fe)

    
- TFC ì½˜ì†”ì—ì„œ Plan ì‹¤í–‰
    
    ![Untitled 14](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/f788b5b9-b4b0-450d-9817-c21c0ef5a88c)

    

ë‹¤ì‹œ PR ìƒì„±ëœ ê²ƒì„ í™•ì¸í•´ ë³´ë©´ Plan Outputì´ ë³´ì¸ë‹¤!

![Untitled 15](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/fbeea4f3-a009-4b2b-a812-a32762249f0e)


## EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ í”„ë¡œë¹„ì €ë‹ë˜ì—ˆëŠ”ì§€ í™•ì¸

ì•„ë˜ PRì„ main ë¸Œëœì¹˜ë¡œ Mergeí•˜ì—¬ Applyê°€ ì‹¤í–‰ë˜ê²Œ íŠ¸ë¦¬ê±°ë¥¼ ë™ì‘ì‹œí‚¬ ê²ƒì´ë‹¤

![Untitled 16](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/b8786eec-9498-4672-95ce-ee076cf52334)


ê·¸ëŸ¼ merge ë˜ì—ˆë‹¤ê³  í™”ë©´ì— í‘œì‹œë˜ê³  í•´ë‹¹ PRì€ closed ìƒíƒœë¡œ ë°”ë€ë‹¤

![Untitled 17](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/df5aeb43-8f23-4f2c-97fd-bb5f0a88e82b)


ì•„ê³  ê·¼ë° ì›Œí¬í”Œë¡œìš°ê°€ Failedë¡œ ë–´ê¸¸ë˜ í™•ì¸í•´ ë³´ë‹ˆ ì˜¤íƒˆì ë•Œë¬¸ì— syntax ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ ã…ã…..

![Untitled 18](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/58afce65-c6eb-41eb-b3cb-08cc589518fa)


ë‹¤ì‹œ ì‘ì—…í•´ ì¤˜ì•¼ê² ë‹¤

ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ íŠ¸ë¦¬ê±°ê°€ ë™ì‘í•˜ì—¬ terraform-apply.ymlì„ ì‹¤í–‰ì‹œí‚¤ê³  ì‹¤ì œ Applyê°€ ì§„í–‰ë  ê²ƒì´ë‹¤

![Untitled 19](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/4d084c68-1a7b-43c2-a735-e177ed8a8b96)


ì§„í–‰ì¤‘ì¸ ë‹¨ê³„ì—ì„œ TFC ë§í¬ë¡œ ë°”ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤

![Untitled 20](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/3930518e-f867-4160-a472-9b963500d722)


ê·¸ëŸ¼ í˜„ì¬ TFCì—ì„œ Applyë¥¼ ì‹¤í–‰ì‹œì¼œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ê°€ ë°°í¬ëœ ê²ƒê³¼ Outputsì„ í†µí•´ ë™ì‘ ì—¬ë¶€ë¥¼ ë¸Œë¼ìš°ì €ë¡œ í™•ì¸ë„ ê°€ëŠ¥í•˜ë‹¤

![Untitled 21](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/33bdd65c-7d1d-4e0e-a120-40440c575e8a)


![Untitled 22](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/f1ff10cc-643b-4841-8173-e2ac89dea63f)


![Untitled 23](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/82a7fcfa-678c-4aad-ad49-fbb356fedade)


ë°°í¬ ì„±ê³µ!

## Resource ë° Workspace ì‚­ì œ

[ì°¸ì¡° ) Destroy resources and workspaces | Terraform | HashiCorp Developer](https://developer.hashicorp.com/terraform/tutorials/cloud-get-started/cloud-destroy)

ë¦¬ì†ŒìŠ¤ ì‚­ì œë„ workflowë¡œ ì—°ë™í•  ìˆ˜ ìˆëŠ”ë° ì˜¤ëŠ˜ì€ ìœ„ ë§í¬ì²˜ëŸ¼ TFCì—ì„œ ì‚­ì œí•´ ì£¼ê² ë‹¤!

![Untitled 24](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/6398c3f8-ffe9-47fb-9a7c-4adda084e9b4)


ì‹¤ì œ ë°°í¬ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ê±°ë‚˜ TFCì˜ workspaceë¥¼ ì‚­ì œí•˜ëŠ” ê²ƒì´ë‹¤

- **Queue destroy plan**
    - `terraform plan -destroy -out=destroy.tfplan` ëª…ë ¹ì–´ì™€ ê°™ë‹¤. ì´ëŠ” tfplan íŒŒì¼ì„ í†µí•´ ë¦¬ì†ŒìŠ¤ ìƒì„± í˜¹ì€ ì‚­ì œí•˜ëŠ” planì„ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.
    - í•´ë‹¹ íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚­ì œí•˜ë ¤ë©´ `terraform apply destroy.tfplan`ì„ ìˆ˜í–‰í•´ì•¼ í•œë‹¤!
- **Force Delete from Terraform Cloud**
    - ì´ëŠ” TFCì˜ Workspaceë§Œ ì‚­ì œí•˜ëŠ” ê²ƒìœ¼ë¡œ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì£¼ì˜í•œë‹¤!

ì´ì œ **Queue destroy plan**ì„ ëˆŒëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì!

destroy planì„ í™•ì¸í•˜ê³  ì•„ë˜ **Cofirm & Apply**ë¥¼ ëˆŒëŸ¬ ì‚­ì œë¥¼ ì§„í–‰í•˜ì!

![Untitled 25](https://github.com/gain-yoo/gain-yoo.github.io/assets/100563973/57524a83-c6b3-4314-9afa-83cc47accd4a)


ì‚­ì œëŠ” ê¹”ë”í•˜ê²Œ ì™„ë£Œí•˜ì˜€ë‹¤

UIë¡œ ì§ê´€ì ìœ¼ë¡œ ì‚­ì œ í™•ì¸ì´ ê°€ëŠ¥í•˜ì—¬ TFCê°€ ìœ ìš©í•˜ë‹¤

## ê²°ë¡ 

ì¥ì ì€ ì—¬ëŸ¿ìˆë‹¤.

Githubì„ ì½”ë“œì €ì¥ì†Œë¡œ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ íˆìŠ¤í† ë¦¬ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ê³  ì½”ë“œ ìˆ˜ì • ë° ì½”ë“œ ê³µìœ ê°€ ì‰½ë‹¤

Github Actionsë¡œ Plan ë° Apply ìë™í™”ê°€ ê°€ëŠ¥í•˜ë©°, í˜‘ì—…í•˜ê¸° ìœ„í•´ PR ë° Mergeë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ê³µë™ ì‘ì—…ì„ í•˜ê¸° ì ë‹¹í•´ ë³´ì¸ë‹¤. Destroyë„ workflowë¥¼ ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ ì´ ê¸€ì—ëŠ” ì¶”ê°€í•˜ì§€ ì•Šì•˜ë‹¤.

ë‹¨ì ìœ¼ë¡œëŠ” ì‘ì—…ìê°€ ë™ì‹œì— pushë¥¼ ì˜¬ë ¸ì„ ë•Œ ì¶©ëŒ..? PRì˜ ìˆœì„œê°€ ì• ë§¤í•´ì§€ë‚˜..? ê²ªì–´ë³´ì§€ ì•Šì•„ì„œ ì–´ë–¤ ì´ìŠˆê°€ ë°œìƒí• ì§€ëŠ” ì •í™•íˆ ëª¨ë¥´ê² ì§€ë§Œ state ê´€ë¦¬ê°€ ë‚œí•´í•´ ì§ˆê±°ë¼ ì˜ˆìƒëœë‹¤

ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  í˜‘ì—…ì„ ìœ„í•œ Gitopsë¡œ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ í”Œë¡œìš°ë¼ê³  ìƒê°í•œë‹¤! ì–¸ì  ê°€ ë‚˜ë„ ì—…ë¬´ì—ì„œ ì“¸ ë‚ ì„ ê³ ëŒ€í•˜ë©° ë§ˆë¬´ë¦¬í•œë‹¤ğŸ¥º
