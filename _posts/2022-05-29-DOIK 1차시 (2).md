---
layout: single
title: "[Database/DOIK] StatefulSet & Headless Service"
excerpt: "Database Operator In Kubernetes ìŠ¤í„°ë”” 1ì°¨ì‹œ - pod ìƒì„± ë° ë™ì‘ í™•ì¸_ì‘ì„±ì¤‘"
categories: Database
tag: [DOIK, Database Operator in Kubernetes, Database, ë°ì´í„°ë² ì´ìŠ¤, Kubernetes, ì¿ ë²„ë„¤í‹°ìŠ¤, DevOps, AWS, CloudFormation, StatefulSet, Headless Service, ìŠ¤í…Œì´íŠ¸í’€ì…‹, í—¤ë“œë¦¬ìŠ¤ì„œë¹„ìŠ¤]
toc: true
author_profile: false
sidebar:
    nav: "docs"
---

**Database**ë¥¼ **Kubernetes** í™˜ê²½ì—ì„œ **ìš´ì˜**í•˜ê¸° ìœ„í•´ì„œ <u>ë°˜ë“œì‹œ</u> í•„ìš”í•œ ê²ƒì€ ì•„ë˜ì™€ ê°™ë‹¤.
- íœ˜ë°œë˜ì§€ ì•Šì€ **ì˜êµ¬ ì €ì¥ì†Œ**
- podì˜ Dynamic IP ì£¼ì†Œê°€ ì•„ë‹Œ **Staticí•œ ì ‘ì† ì£¼ì†Œ**
- ë³´ì•ˆ ê°ì‚¬ ë§Œì¡±ì„ ìœ„í•œ **DB ì ‘ê·¼ í†µì œ**
- DB ìƒíƒœê°€ **ì •ìƒì¸ì§€** íŒë‹¨í•  ê¸°ì¤€

> ğŸ’¡ <u>ì˜êµ¬ ì €ì¥ì†Œ</u>ì™€ <u>Static ì ‘ì† ì£¼ì†Œ</u>ì˜ ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚¤ëŠ” ê²ƒì´ ë°”ë¡œ **<u>StatefulSet</u>**ì´ë‹¤.
  
<br>
# â˜ StatefulSet & Headless Serviceì˜ ê°œë…ì„ ì •ë¦¬í•˜ìë©´ ????

## âœ” StatefulSet ì´ë€?
StatefulSetì€ kubernetes ë¦¬ì†ŒìŠ¤ ì¤‘ <u>Deploymentì™€ ìœ ì‚¬í•˜ê²Œ</u> podë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì´ë‹¤.  
scalingì„ ê´€ë¦¬í•˜ë©°, podë“¤ì˜ **ìˆœì„œ ë° ê³ ìœ ì„±**ì„ ë³´ì¥í•œë‹¤.  
  
Deploymentì™€ ë¹„êµí•˜ì—¬ ë§í•˜ìë©´  
`Deployment`ì˜ ê²½ìš°, podëª…ì´ <u>ë‚œìˆ˜ë¡œ ìƒì„±ë˜ì–´</u> ìƒì„±ë˜ëŠ” ìˆœì„œë‚˜ podëª…ì˜ ê³ ìœ ì„±ì„ ë³´ì¥ë°›ì§€ ëª»í•œë‹¤.  
í•˜ì§€ë§Œ `StatefulSet`ì˜ ê²½ìš°, podëª…ì´ ë‚œìˆ˜ê°€ ì•„ë‹Œ **ê³ ìœ í•œ ìˆ«ì**ë¥¼ ê°€ì§€ê²Œ ë˜ê³  **ìˆ«ì 0ë¶€í„° ìˆœì„œëŒ€ë¡œ** ìƒì„±ëœë‹¤. *(ë§Œì•½ ì¤‘ê°„ì— 1ë²ˆì„ ì§€ìš´ë‹¤ê³  í•´ë„ ë‹¤ìŒ ìƒì„±ë˜ëŠ” ìˆ«ìëŠ” 1ì´ë‹¤.)*  
  
ì•„ë˜ Deploymentì™€ StatefulSetë¡œ ìƒì„±í•œ pod ëª…ì˜ ë¹„êµ ì˜ˆì‹œë¥¼ ê°€ì ¸ ì™”ë‹¤.  

```java
(ğŸ± |DOIK-Lab:default) root@k8s-m:~# kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
deploy-cf9b57fb9-gdd68   1/1     Running   0          8s
deploy-cf9b57fb9-p2dtq   1/1     Running   0          39s
deploy-cf9b57fb9-tzxnz   1/1     Running   0          8s
```

```java
(ğŸ± |DOIK-Lab:default) root@k8s-m:~# kubectl get pods
NAME         READY   STATUS    RESTARTS   AGE
stateful-0   1/1     Running   0          102s
stateful-1   1/1     Running   0          82s
stateful-2   1/1     Running   0          62s
```

## âœ” Headless Service ë€?

Kubernetes ë¦¬ì†ŒìŠ¤ì—ì„œ ServiceëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ë¡œ ë…¸ì¶œí•˜ëŠ” ë°©ë²•ì´ë‹¤.  
`ServiceTypes`ì€ ClusterIP, NodePort, LoadBalancer, ExternalNameê°€ ìˆëŠ”ë° Headless Serviceë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ìš°ì„  `ServiceTypes`ì€ **ClusterIP**ë¡œ ì„¤ì •í•˜ë©´ ëœë‹¤.  
  
ClusterIPëŠ” ì„œë¹„ìŠ¤ë¥¼ í´ëŸ¬ìŠ¤í„°-ë‚´ë¶€IPì— ë…¸ì¶œì‹œí‚¤ëŠ” ê±°ë¼ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œë§Œ ì„œë¹„ìŠ¤ì— ë„ë‹¬í•  ìˆ˜ ìˆë‹¤.  
  
ê·¼ë° Headless Serviceë¼ë‹ˆ.. ë§ ê·¸ëŒ€ë¡œ ë¨¸ë¦¬ê°€ ì—†ëŠ” ì„œë¹„ìŠ¤ë‹¤(?)  
ì‚¬ì§„  
`ClusterIP: None`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬, í´ëŸ¬ìŠ¤í„° ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ì—ì„œ í•´ë‹¹ Podì— ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥í•œ **ê³ ìœ  IP**ì™€ **DNS**ê°€ ìƒê¸°ëŠ” ê²ƒì´ë‹¤.
  
# ğŸ¤˜ ì‹¤ìŠµìœ¼ë¡œ í™•ì¸í•˜ëŠ” StatefulSet & Headless Service

## âœ” StatefulSetìœ¼ë¡œ podë¥¼ ë°°í¬í•´ ë³´ì!
1. web.yaml íŒŒì¼ ë°›ì•„ ì˜¤ê¸°
		
	```java
	(ğŸ± |DOIK-Lab:default) root@k8s-m:~# curl -s -O https://raw.githubusercontent.com/kubernetes/website/main/content/en/examples/application/web/web.yaml
	(ğŸ± |DOIK-Lab:default) root@k8s-m:~# cat web.yaml 
	  â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
			 â”‚ File: web.yaml
	  â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
		1    â”‚ apiVersion: v1
		2    â”‚ kind: Service
		3    â”‚ metadata:
		4    â”‚   name: nginx
		5    â”‚   labels:
		6    â”‚     app: nginx
		7    â”‚ spec:
		8    â”‚   ports:
		9    â”‚   - port: 80
		10   â”‚     name: web
		11   â”‚   clusterIP: None
		12   â”‚   selector:
		13   â”‚     app: nginx
		14   â”‚ ---
		15   â”‚ apiVersion: apps/v1
		16   â”‚ kind: StatefulSet
		17   â”‚ metadata:
		18   â”‚   name: web
		19   â”‚ spec:
		20   â”‚   serviceName: "nginx"
		21   â”‚   replicas: 2
		22   â”‚   selector:
		23   â”‚     matchLabels:
		24   â”‚       app: nginx
		25   â”‚   template:
		26   â”‚     metadata:
		27   â”‚       labels:
		28   â”‚         app: nginx
		29   â”‚     spec:
		30   â”‚       containers:
		31   â”‚       - name: nginx
		32   â”‚         image: k8s.gcr.io/nginx-slim:0.8
		33   â”‚         ports:
		34   â”‚         - containerPort: 80
		35   â”‚           name: web
		36   â”‚         volumeMounts:
		37   â”‚         - name: www
		38   â”‚           mountPath: /usr/share/nginx/html
		39   â”‚   volumeClaimTemplates:
		40   â”‚   - metadata:
		41   â”‚       name: www
		42   â”‚     spec:
		43   â”‚       accessModes: [ "ReadWriteOnce" ]
		44   â”‚       resources:
		45   â”‚         requests:
		46   â”‚           storage: 1Gi
		47   â”‚
		â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	```
2. web.yamlìœ¼ë¡œ Headless Serviceì™€ StatefulSet ìƒì„±

	```java
	(ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl apply -f web.yaml && kubectl get pods -w -l app=nginx
		service/nginx created
		statefulset.apps/web created
		NAME    READY   STATUS    RESTARTS   AGE
		web-0   0/1     Pending   0          0s
		web-0   0/1     Pending   0          9s
		web-0   0/1     ContainerCreating   0          9s
		web-0   0/1     ContainerCreating   0          9s
		web-0   1/1     Running             0          18s
		web-1   0/1     Pending             0          0s
		web-1   0/1     Pending             0          10s
		web-1   0/1     ContainerCreating   0          10s
		web-1   0/1     ContainerCreating   0          11s
		web-1   1/1     Running             0          20s
	```
3. web-0, web-1 podì— ì ‘ì†í•´ì„œ hostname ì¶œë ¥í•˜ê¸°

	```java
	(ğŸ |DOIK-Lab:default) root@k8s-m:~# for i in 0 1; do kubectl exec "web-$i" -- sh -c 'hostname'; done
		web-0
		web-1
	```

4. ë‹¤ë¥¸ í„°ë¯¸ë„ë¡œ ëª¨ë‹ˆí„°ë§
		
	![Untitled](StatefulSet%20&%20Headless%20Service_%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%89%E1%85%A5%E1%86%BC%E1%84%8C%E1%85%AE%E1%86%BC%209349dfc8cad1499eaca1445ba79823d3/Untitled%202.png)
        
## 0ï¸âƒ£ Headless Service íŠ¹ì§• ) podë§ˆë‹¤ ê³ ìœ í•œ ì£¼ì†Œë¥¼ ê°–ëŠ”ë‹¤

1. netshoot ì´ë¯¸ì§€ë¡œ netdebug pod ìƒì„±í•˜ì—¬ zshë¡œ ì ‘ì†!
- `--rm` : ì‰˜ì´ ì¢…ë£Œë˜ë©´ podë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•´ ì£¼ëŠ” ì˜µì…˜ì´ë‹¤. *(podë¥¼ ì¼ì‹œì ìœ¼ë¡œ ìƒì„±)*
- `--restart` : Container restartPolicy ì˜µì…˜ì„ ì˜ë¯¸í•˜ë©°, ì‚¬ìš© ê°€ëŠ¥í•œ ê°’ì€  Always, OnFailure, Neverì´ë‹¤. *(ê¸°ë³¸ ê°’: Always)*

	```java
	(ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl run -it --rm netdebug --image=nicolaka/netshoot --restart=Never -- zsh

		If you don't see a command prompt, try pressing enter.
		
							dP            dP                           dP
							88            88                           88
		88d888b. .d8888b. d8888P .d8888b. 88d888b. .d8888b. .d8888b. d8888P
		88'  `88 88ooood8   88   Y8ooooo. 88'  `88 88'  `88 88'  `88   88
		88    88 88.  ...   88         88 88    88 88.  .88 88.  .88   88
		dP    dP `88888P'   dP   `88888P' dP    dP `88888P' `88888P'   dP
		
		Welcome to Netshoot! (github.com/nicolaka/netshoot)
		
		

			netdebug î‚° ~
	```

2. nginx service ì´ë¦„ìœ¼ë¡œ ë„ë©”ì¸ ì§ˆì˜í–ˆë”ë‹ˆ headless serviceì— ë¬¶ì¸ podì˜ ip ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ ì¤€ë‹¤.

    ```java
		netdebug î‚° ~ î‚° nslookup nginx
		Server:         10.200.1.10
		Address:        10.200.1.10#53
		
		Name:   nginx.default.svc.cluster.local
		Address: 172.16.24.2
		Name:   nginx.default.svc.cluster.local
		Address: 172.16.158.2
	```

3. ê° podì˜ ë ˆì½”ë“œ ê°’ì„ ì§ì ‘ ì•Œê¸° ìœ„í•´ `-type=srv`ë¼ëŠ” íƒœê·¸ ê°’ì„ ì…ë ¥í•´ ì¤€ë‹¤.

	```java
		netdebug î‚° ~ î‚° nslookup -type=srv nginx     
		Server:         10.200.1.10
		Address:        10.200.1.10#53
		
		nginx.default.svc.cluster.local service = 0 50 80 web-0.nginx.default.svc.cluster.local.
		nginx.default.svc.cluster.local service = 0 50 80 web-1.nginx.default.svc.cluster.local.
	```

4. ê° podì˜ ê³ ìœ í•œ ì£¼ì†Œë¡œ íŠ¹ì • podë¥¼ ì°¾ì•„ê°ˆ ìˆ˜ ìˆë‹¤.

	```java
		netdebug î‚° ~ î‚° nslookup web-0.nginx
		Server:         10.200.1.10
		Address:        10.200.1.10#53
		
		Name:   web-0.nginx.default.svc.cluster.local
		Address: 172.16.158.2
	
	
		netdebug î‚° ~ î‚° nslookup web-1.nginx
		Server:         10.200.1.10
		Address:        10.200.1.10#53
		
		Name:   web-1.nginx.default.svc.cluster.local
		Address: 172.16.24.2
	```
	
5. ì‰˜ ì¢…ë£Œí•˜ë‹ˆ podê°€ ìë™ ì‚­ì œëë‹¤!

		netdebug î‚° ~ î‚° exit
		pod "netdebug" deleted
    ```

## 1ï¸âƒ£ StatefulSet íŠ¹ì§•1) podë¥¼ ì‚­ì œí•˜ë©´ ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ podë¡œ ì¬ìƒì„±ëœë‹¤

1. pod ì‚­ì œ ì‹¤í–‰ í›„ ì¬ì‹¤í–‰ ì‹œ podëª… í™•ì¸
    
    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl delete pod -l app=nginx && kubectl get pods -w -l app=nginx
    		pod "web-0" deleted
    		pod "web-1" deleted
    		NAME    READY   STATUS              RESTARTS   AGE
    		web-0   0/1     ContainerCreating   0          1s
    		web-0   1/1     Running             0          2s
    		web-1   0/1     Pending             0          0s
    		web-1   0/1     Pending             0          0s
    		web-1   0/1     ContainerCreating   0          0s
    		web-1   0/1     ContainerCreating   0          1s
    		web-1   1/1     Running             0          2s
    ```

2. ê° podë¡œ ì ‘ì†í•˜ì—¬ hostname í™•ì¸

	```java
	(ğŸ |DOIK-Lab:default) root@k8s-m:~# for i in 0 1; do kubectl exec web-$i -- sh -c 'hostname'; done
    	web-0
    	web-1
	```

## 2ï¸âƒ£ StatefulSet íŠ¹ì§•2) podëŠ” ì˜ì†ì ì¸ ì €ì¥ì†Œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤
    
1. pvc í™•ì¸
    
    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl get pvc -l app=nginx
    	NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
    	www-web-0   Bound    pvc-7cce446e-e68a-4783-99f9-fbb891538669   1Gi        RWO            local-path     11m
    	www-web-1   Bound    pvc-7defb95e-8b02-4886-851b-e339e234fd71   1Gi        RWO            local-path     11m
    ```
    
2. ì›¹ ì„œë²„ index.html ì— hostname ì¶”ê°€ í›„ ì›¹ ì ‘ì† í•´ì„œ í™•ì¸
    
    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# for i in 0 1; do kubectl exec "web-$i" -- sh -c 'echo "$(hostname)-pv-test" > /usr/share/nginx/html/index.html'; done
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# for i in 0 1; do kubectl exec -i -t "web-$i" -- curl http://localhost/; done
    	web-0-pv-test
    	web-1-pv-test
    ```
    
3. `app=nginx` label ê°’ì„ ê°€ì§„ pod ì‚­ì œ ì‹¤í–‰ í›„ scaling í™•ì¸
    
    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl delete pod -l app=nginx && kubectl get pods -w -l app=nginx
    	pod "web-0" deleted
    	pod "web-1" deleted
    	NAME    READY   STATUS              RESTARTS   AGE
    	web-0   0/1     ContainerCreating   0          0s
    	web-0   0/1     ContainerCreating   0          1s
    	web-0   1/1     Running             0          2s
    	web-1   0/1     Pending             0          0s
    	web-1   0/1     Pending             0          0s
    	web-1   0/1     ContainerCreating   0          0s
    	web-1   0/1     ContainerCreating   0          1s
    	web-1   1/1     Running             0          2s
    ```
    
4. ì›¹ ì ‘ì† í•´ì„œ í™•ì¸ : PV ì €ì¥ì†Œ í™•ì¸  
  
	âœ… ê³ ìœ  ì´ë¦„ì„ ê°€ì§„ podê°€ ì‚­ì œë˜ê³  ë‹¤ì‹œ ìƒì„±ë˜ë”ë¼ë„ í•´ë‹¹ podëŠ” **ê¸°ì¡´ ì‚¬ìš©í•˜ë˜ pv**ë§Œ ì‚¬ìš©í•œë‹¤  
		*(ex. `web-0`ë¼ëŠ” podëŠ” `web-0-pv-test`ë¼ëŠ” pvë§Œ ê³„ì† ë¬¼ê³  ì˜¨ë‹¤)*  
	âœ… ì´ê²Œ ë°”ë¡œ **ì˜ì†ì ì¸ ì €ì¥ì†Œ**ë¥¼ ë³´ì¥ë°›ëŠ” StatefulSetì˜ íŠ¹ì§•ì´ë‹¤
    
    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# for i in 0 1; do kubectl exec -i -t "web-$i" -- curl http://localhost/; done
    	web-0-pv-test
    	web-1-pv-test
    ```

## 3ï¸âƒ£ StatefulSet íŠ¹ì§•3) podëŠ” ê³ ìœ í•œ ì´ë¦„ì„ ê°€ì§€ë©°, 0ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ìƒì„±ëœë‹¤

1. pod scale out  
  
    âœ… podê°€ ì¦ê°€ ë˜ëŠ” ê°ì†Œí•  ë•Œ **ìˆœì°¨ì ìœ¼ë¡œ** ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

    ```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl scale sts web --replicas=5 && kubectl get pods -w -l app=nginx
    	statefulset.apps/web scaled
    	NAME    READY   STATUS    RESTARTS   AGE
    	web-0   1/1     Running   0          88s
    	web-1   1/1     Running   0          86s
    	web-2   0/1     Pending   0          0s
    	web-2   0/1     Pending   0          10s
    	web-2   0/1     ContainerCreating   0          10s
    	web-2   0/1     ContainerCreating   0          11s
    	web-2   1/1     Running             0          18s
    //...ìƒëµ...
	```

2.  pod scale in  

	```java
    (ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl patch sts web -p '{"spec":{"replicas":3}}' && kubectl get pods -w -l app=nginx
    	statefulset.apps/web patched
    	NAME    READY   STATUS        RESTARTS   AGE
    	web-0   1/1     Running       0          2m54s
    	web-1   1/1     Running       0          2m52s
    	web-2   1/1     Running       0          86s
    	web-3   1/1     Running       0          68s
    	web-4   1/1     Terminating   0          61s
    	web-4   1/1     Terminating   0          62s
    	web-4   0/1     Terminating   0          62s
    	web-4   0/1     Terminating   0          62s
    	web-4   0/1     Terminating   0          62s
    //...ìƒëµ...
    ```
    
## âœ” ì‹¤ìŠµì„ ë§ˆì¹˜ê³  ë¦¬ì†ŒìŠ¤ ì‚­ì œ!
    
```java
(ğŸ |DOIK-Lab:default) root@k8s-m:~# kubectl delete -f web.yaml && kubectl delete pvc --all
	service "nginx" deleted
	statefulset.apps "web" deleted
	persistentvolumeclaim "www-web-0" deleted
	persistentvolumeclaim "www-web-1" deleted
	persistentvolumeclaim "www-web-2" deleted
	persistentvolumeclaim "www-web-3" deleted
	persistentvolumeclaim "www-web-4" deleted
```	