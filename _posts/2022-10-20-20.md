---
published: true
layout: single
title: "[DevOps/Terraform/T101] ì‚¬ì „ ì‘ì—… ë° í…Œë¼í¼ ì„¤ì¹˜"
excerpt: "T101 í…Œë¼í¼ ìŠ¤í„°ë”” 0ì°¨ì‹œ - ì‚¬ì „ ì‘ì—… ë° í…Œë¼í¼ ì„¤ì¹˜"
categories: DevOps
tag: [Kubernetes, Terraform]
toc: true
author_profile: false
sidebar:
    nav: "docs"
---

# ì‚¬ì „ì¤€ë¹„

ì‚¬ìš©í•œ OS í™˜ê²½ì€ **Ubuntu 20.04.5 LTS (wsl2)** ì´ë‹¤.

## 1. AWS IAM User

### (1) AWS Identity and Access Management(IAM)ì´ë€?

AWSÂ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆëŠ” ì›¹ ì„œë¹„ìŠ¤ë‹¤.
IAMì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ **ì¸ì¦**(ë¡œê·¸ì¸) ë° **ê¶Œí•œ** ë¶€ì—¬(ê¶Œí•œ ìˆìŒ)ëœ ëŒ€ìƒì„ ì œì–´í•œë‹¤.


> ğŸ’¡ **IAM = Authentication + Authorization**



### (2) ê¶Œí•œ

ì•„ë˜ ë‘ ê¶Œí•œì„ IAM Userì— ë¶€ì—¬í•´ ì¤„ ê²ƒì´ë‹¤.

- `AdministratorAccess` : ê´€ë¦¬ì ê¶Œí•œ
- `í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤ ê¶Œí•œ` : Access/Secret Key

### (3) IAM User ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬

1. **IAM > ì‚¬ìš©ì > ì‚¬ìš©ì ì¶”ê°€**
    - ì‚¬ìš©ì ì´ë¦„
    - AWS ìê²© ì¦ëª… ìœ í˜• ì„ íƒ : `í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤` / `AWS Management Concole ì•¡ì„¸ìŠ¤` ì²´í¬
    - ì½˜ì†” ë¹„ë°€ë²ˆí˜¸ : `ì‚¬ìš©ì ì§€ì • ë¹„ë°€ ë²ˆí˜¸`
    - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í•„ìš” : ì²´í¬ í•´ì œ
    
    ![image](https://user-images.githubusercontent.com/100563973/197320057-ecd62018-e305-45e3-a92e-f7f73274219f.png)
    
2. **ê¸°ì¡´ ì •ì±… ì§ì ‘ ì—°ê²° > AdministratorAccess**
    
    ![image](https://user-images.githubusercontent.com/100563973/197320065-898e6e53-6a73-4f7f-adc2-0d986711d7ed.png)
    
3. **ë‹¤ìŒ: ê²€í†  > ì‚¬ìš©ì ë§Œë“¤ê¸° > ì‚¬ìš©ì ìƒì„± ì„±ê³µ**
    
    ![image](https://user-images.githubusercontent.com/100563973/197320070-37f37eea-227c-4570-9390-308b0df08a28.png)
    

## 2. AWS CLI v2 ì„¤ì¹˜ ë° IAM User ìê²© ì¦ëª… ì„¤ì •

### (1) AWS CLI v2 ì„¤ì¹˜

[ìµœì‹  ë²„ì „ì˜ AWS CLI ì„¤ì¹˜ ë˜ëŠ” ì—…ë°ì´íŠ¸](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html)

```bash
$ curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
$ sudo apt install unzip
$ ls -al
	total 46140
	drwxrwxrwx 1 gain gain     4096 Oct 20 19:09 .
	drwxrwxrwx 1 gain gain     4096 Oct 18 22:22 ..
	drwxrwxrwx 1 gain gain     4096 Oct 18 22:24 .git
	-rwxrwxrwx 1 gain gain       88 Oct 18 22:23 README.md
	-rw-r--r-- 1 gain gain 47244662 Oct 20 19:09 awscliv2.zip
$ unzip awscliv2.zip
$ sudo ./aws/install
	You can now run: /usr/local/bin/aws --version
$ /usr/local/bin/aws --version
	aws-cli/2.8.4 Python/3.9.11 Linux/4.4.0-19041-Microsoft exe/x86_64.ubuntu.20 prompt/off
$ aws --version
	aws-cli/2.8.4 Python/3.9.11 Linux/4.4.0-19041-Microsoft exe/x86_64.ubuntu.20 prompt/off
```

### (2) IAM User ìê²© ì¦ëª… ì„¤ì •

[ë¹ ë¥¸ ì„¤ì •](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-quickstart.html)

```bash
$ aws configure
	AWS Access Key ID [None]: 
	AWS Secret Access Key [None]:
	Default region name [None]: ap-northeast-2
	Default output format [None]:
$ aws configure list
	      Name                    Value             Type    Location
	      ----                    -----             ----    --------
	   profile                <not set>             None    None
	access_key     ****************A3UL shared-credentials-file
	secret_key     ****************IIA1 shared-credentials-file
	    region           ap-northeast-2      config-file    ~/.aws/config
```

```bash
# í˜ì´ì € ì‚¬ìš© ë¹„í™œì„±í™”
export AWS_PAGER=""
```

## 3. ì‹¤ìŠµì— í¸ë¦¬í•œ tool ì„¤ì¹˜ : watch, jq, tree ë“±

```bash
$ sudo apt install update
	Reading package lists... Done
	Building dependency tree
	Reading state information... Done
	E: Unable to locate package update
$ sudo apt update
$ sudo apt install tree jq watch
```

## 4. AWS ì„œìš¸ ë¦¬ì „(ap-northeast-2)ì— default VPC ì¡´ì¬ í™•ì¸ - [ë§í¬](https://www.44bits.io/ko/post/inspect_resources_in_default_vpc_by_aws_cli)

```bash
$ aws ec2 describe-vpcs --filter 'Name=isDefault,Values=true' | jq
	{
	  "Vpcs": [
	    {
	      "CidrBlock": "172.31.0.0/16",
	      "DhcpOptionsId": "dopt-067e607e16d1f0500",
	      "State": "available",
	      "VpcId": "vpc-080a8fc7af6f1c0e8",
	      "OwnerId": "062168528481",
	      "InstanceTenancy": "default",
	      "CidrBlockAssociationSet": [
	        {
	          "AssociationId": "vpc-cidr-assoc-0a4fd8582b15fc53a",
	          "CidrBlock": "172.31.0.0/16",
	          "CidrBlockState": {
	            "State": "associated"
	          }
	        }
	      ],
	      "IsDefault": true
	    }
	  ]
	}
$ aws ec2 describe-vpcs --filter 'Name=isDefault,Values=true' | jq '.Vpcs[0].VpcId'
	"vpc-080a8fc7af6f1c0e8"
$ aws ec2 describe-subnets --filter 'Name=vpc-id,Values=vpc-080a8fc7af6f1c0e8' --output table
	-----------------
	|DescribeSubnets|
	+---------------+
```
  
  
  
# í…Œë¼í¼ ì„¤ì¹˜

## 1. í…Œë¼í¼ - Ubuntu 20.04.5 LTS (WSL2)
  
  
[Install Terraform - HashiCorp Learn](https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started)
  
  
1. Prerequisite : curl, gnupg, software-properties-common ì„¤ì¹˜
    
    ```bash
    $ sudo apt-get update && sudo apt-get install -y gnupg software-properties-common
    ```
    
2. HashiCorpÂ GPG key ë‹¤ìš´
    
    ```bash
    $ wget -O- https://apt.releases.hashicorp.com/gpg | \
    >     gpg --dearmor | \
    >     sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg
    ```
    
3. Keyâ€™s fingerprint í™•ì¸
    
    ```bash
    $ gpg --no-default-keyring \
    >     --keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg \
    >     --fingerprint
    	gpg: directory '/home/gain/.gnupg' created
    	gpg: /home/gain/.gnupg/trustdb.gpg: trustdb created
    	/usr/share/keyrings/hashicorp-archive-keyring.gpg
    	-------------------------------------------------
    	pub   rsa4096 2020-05-07 [SC]
    	      E8A0 32E0 94D8 EB4E A189  D270 DA41 8C88 A321 9F7B
    	uid           [ unknown] HashiCorp Security (HashiCorp Package Signing) <security+packaging@hashicorp.com>
    	sub   rsa4096 2020-05-07 [E]
    ```
    
4. `lsb_release -cs` : í˜„ì¬ ë‚´ ì‹œìŠ¤í…œì˜ ë°°í¬ ë¦´ë¦¬ì¦ˆ ì½”ë“œëª…ì„ ì°¾ì•„ì¤€ë‹¤.
    
    ```bash
    $ echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \
    >     https://apt.releases.hashicorp.com $(lsb_release -cs) main" | \
    >     sudo tee /etc/apt/sources.list.d/hashicorp.list
    	deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg]     https://apt.releases.hashicorp.com focal main
    ```
    
5. HashiCorpë¡œë¶€í„° íŒ¨í‚¤ì§€ ì •ë³´ë¥¼ ë‹¤ìš´ë°›ê³  Terraformì„ ì„¤ì¹˜í•œë‹¤!
    
    ```bash
    $ sudo apt update && sudo apt-get install terraform
    ```
    
6. terraform ë²„ì „ í™•ì¸
    
    ```bash
    $ terraform version
    	Terraform v1.3.3
    	on linux_amd64
    ```
    

## 2. ìë™ì™„ì„± ì„¤ì •

1. ìë™ì™„ì„± ì ìš©
```bash
$ touch ~/.bashrc
$ terraform -install-autocomplete
```

2. í™•ì¸
```bash
$ cat ~/.bashrc | grep complete
	complete -C /usr/bin/terraform terraform
```

# Githubì— ì½”ë“œ ì €ì¥í•˜ê¸°

í˜•ìƒ ê´€ë¦¬ íˆ´ì¸ Githubë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ íŒ€ êµ¬ì„±ì›ê³¼ ì½”ë“œ ê³µìœ ë„ ê°€ëŠ¥í•˜ê³ ,
ì¸í”„ë¼ì˜ ë³€ê²½ ë‚´ìš© ì¶”ì  ë° ì»¤ë°‹ ë¡œê·¸ë¥¼ í†µí•œ ë””ë²„ê¹…ì´ ê°€ëŠ¥í•´ ì§„ë‹¤.

```bash
$ ls -al
	total 46160
	drwxrwxrwx 1 gain gain     4096 Oct 21 19:24 .
	drwxrwxrwx 1 gain gain     4096 Oct 18 22:22 ..
	drwxrwxrwx 1 gain gain     4096 Oct 18 22:24 .git
	drwxr-xr-x 1 gain gain     4096 Oct 20 23:44 .terraform
	-rw-r--r-- 1 gain gain     1152 Oct 20 23:44 .terraform.lock.hcl
	-rwxrwxrwx 1 gain gain       88 Oct 18 22:23 README.md
	drwxr-xr-x 1 gain gain     4096 Oct 19 17:18 aws
	-rw-r--r-- 1 gain gain 47244662 Oct 20 19:09 awscliv2.zip
	-rw-r--r-- 1 gain gain      911 Oct 21 19:23 main.tf
	-rw-r--r-- 1 gain gain     6139 Oct 21 19:24 terraform.tfstate
	-rw-r--r-- 1 gain gain      179 Oct 21 19:24 terraform.tfstate.backup
```

```bash
$ git remote -v
	origin  https://github.com/gain-yoo/terraform-study.git (fetch)
	origin  https://github.com/gain-yoo/terraform-study.git (push)
```

```bash
$ vi .gitignore
$ cat .gitignore
	.terraform*
	*.tfstate
	*.tfstate.backup
	aws*
```

<aside>
ğŸ’¡ `.gitignore` íŒŒì¼ì´ë€ íŠ¹ì • ìœ í˜•ì˜ íŒŒì¼ì„ ì‹¤ìˆ˜ë¡œ ì²´í¬ì¸í•˜ì§€ ì•Šê²Œ ë¬´ì‹œí•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

</aside>

- `.terraform` í…Œë¼í¼ì´ Gitì— ì„ì‹œ ìŠ¤í¬ë˜ì¹˜ ë””ë ‰í„°ë¦¬ë¡œ ì‚¬ìš©
- `*.tfstate` í…Œë¼í¼ì´ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©

```bash
$ git add .
$ git commit -m "Week 01 - Chapter 01"

	*** Please tell me who you are.
	
	Run
	
	  git config --global user.email "you@example.com"
	  git config --global user.name "Your Name"
	
	to set your account's default identity.
	Omit --global to set the identity only in this repository.
	
	fatal: empty ident name (for <gain@DESKTOP-94ANG27.localdomain>) not allowed
$ git config --global user.email "rkdlsdb@gmail.com"
$ git config --global user.name "gain-yoo"
$ git config --global user.name
	gain-yoo
$ git config --global user.email
	rkdlsdb@gmail.com
$ git commit -m "Week 01 - Chapter 01"
	[main 7dc682b] Week 01 - Chapter 01
	 2 files changed, 47 insertions(+), 2 deletions(-)
	 create mode 100644 .gitignore
	 create mode 100644 main.tf
```

```bash
$ git pull origin main
$ git push -f origin main
	Username for 'https://github.com': gain-yoo
	Password for 'https://gain-yoo@github.com':
	Enumerating objects: 7, done.
	Counting objects: 100% (7/7), done.
	Delta compression using up to 8 threads
	Compressing objects: 100% (4/4), done.
	Writing objects: 100% (5/5), 905 bytes | 452.00 KiB/s, done.
	Total 5 (delta 0), reused 0 (delta 0)
	To https://github.com/gain-yoo/terraform-study.git
	 + 8b03b5f...fc8081c main -> main (forced update)
```
